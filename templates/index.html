<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Fake Review Detector</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #1e293b 0, #020617 55%);
        color: #e5e7eb;
      }

      .page {
        max-width: 960px;
        margin: 24px auto;
        padding: 16px;
      }

      .card {
        background: rgba(15, 23, 42, 0.96);
        border-radius: 18px;
        padding: 20px 22px 80px 22px;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.55);
        border: 1px solid rgba(148, 163, 184, 0.2);
        position: relative;
      }

      h1 {
        margin: 0;
        font-size: 26px;
        letter-spacing: 0.03em;
      }

      .subtitle {
        margin-top: 6px;
        font-size: 14px;
        color: #9ca3af;
      }

      .subtitle strong {
        color: #e5e7eb;
      }

      .layout {
        display: grid;
        grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
        gap: 20px;
        margin-top: 18px;
      }

      /* --- Left pane: input & history --- */

      .panel {
        background: rgba(15, 23, 42, 0.9);
        border-radius: 14px;
        border: 1px solid rgba(55, 65, 81, 0.8);
        padding: 14px 14px 16px 14px;
      }

      label {
        display: block;
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
      }

      textarea {
        width: 100%;
        min-height: 180px;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #4b5563;
        resize: vertical;
        font-family: inherit;
        font-size: 14px;
        background: #020617;
        color: #e5e7eb;
      }

      textarea::placeholder {
        color: #6b7280;
      }

      .controls-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
        gap: 10px;
      }

      .btn-group {
        display: flex;
        gap: 8px;
      }

      .btn {
        border-radius: 999px;
        border: none;
        padding: 7px 16px;
        font-size: 14px;
        cursor: pointer;
        font-weight: 500;
      }

      .btn-primary {
        background: #2563eb;
        color: white;
      }

      .btn-primary:hover {
        filter: brightness(1.08);
      }

      .btn-secondary {
        background: #111827;
        color: #e5e7eb;
        border: 1px solid #374151;
      }

      .btn-secondary:hover {
        background: #020617;
      }

      .status {
        font-size: 12px;
        color: #9ca3af;
        text-align: right;
        flex: 1;
      }

      .section-title {
        font-size: 13px;
        font-weight: 600;
        margin-top: 14px;
        margin-bottom: 6px;
        color: #d1d5db;
      }

      .history-list {
        max-height: 180px;
        overflow-y: auto;
        padding-right: 4px;
      }

      .history-empty {
        font-size: 12px;
        color: #6b7280;
      }

      .history-item {
        border-radius: 10px;
        border: 1px solid #374151;
        padding: 6px 8px;
        font-size: 12px;
        margin-bottom: 6px;
        background: #020617;
      }

      .history-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 3px;
      }

      .history-model {
        color: #9ca3af;
        font-weight: 600;
      }

      .history-label {
        font-style: italic;
        color: #e5e7eb;
      }

      .history-text {
        color: #9ca3af;
        max-height: 60px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .prediction-panel {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        height: 100%;
        padding: 14px;
        text-align: center;
      }

      .prediction-header {
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .icon-wrapper {
        width: 80px;
        height: 80px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
        background: radial-gradient(circle at 30% 0%, #38bdf8 0, #0f172a 55%);
        border: 1px solid rgba(148, 163, 184, 0.8);
      }

      .icon-wrapper svg {
        width: 44px;
        height: 44px;
        fill: #e5e7eb;
      }

      .icon-wrapper.neutral {
        background: radial-gradient(circle at 30% 0%, #6b7280 0, #0f172a 55%);
        border-color: #4b5563;
      }

      .hidden {
        display: none !important;
      }

      .tube-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 6px;
      }

      .tube-label {
        font-size: 12px;
        color: #9ca3af;
        margin-bottom: 6px;
      }

      .tube {
        width: 44px;
        height: 210px;
        border-radius: 999px;
        padding: 4px;
        background: linear-gradient(180deg, #020617, #0b1120, #020617);
        border: 1px solid #4b5563;
        box-shadow: inset 0 0 10px rgba(15, 23, 42, 0.9);
        display: flex;
        align-items: flex-end;
        justify-content: center;
        overflow: hidden;
      }

      .tube-fill {
        width: 100%;
        height: 0%;
        border-radius: 999px;
        background: linear-gradient(180deg, #7dd3fc, #38bdf8);
        box-shadow: 0 0 18px rgba(56, 189, 248, 0.7);
        transition: height 0.4s ease;
      }

      .prediction-text {
        margin-top: 10px;
      }

      .prediction-label {
        font-size: 18px;
        font-weight: 700;
      }

      .prediction-label.real {
        color: #22c55e;
      }

      .prediction-label.fake {
        color: #f97373;
      }

      .prediction-confidence {
        margin-top: 4px;
        font-size: 13px;
        color: #9ca3af;
      }


      .model-bar {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 10px 18px 14px 18px;
        border-top: 1px solid rgba(31, 41, 55, 0.95);
        background: radial-gradient(circle at top, #020617 0, #020617 60%);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        border-radius: 0 0 18px 18px;
      }

      .model-label {
        font-size: 12px;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.16em;
      }

      .model-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: flex-end;
      }

      .model-tab {
        border-radius: 999px;
        border: 1px solid #4b5563;
        background: #020617;
        padding: 5px 10px;
        font-size: 12px;
        color: #e5e7eb;
        cursor: pointer;
      }

      .model-tab.active {
        background: #2563eb;
        border-color: #2563eb;
        box-shadow: 0 0 12px rgba(37, 99, 235, 0.6);
      }

      @media (max-width: 800px) {
        .card {
          padding-bottom: 110px;
        }
        .layout {
          grid-template-columns: minmax(0, 1fr);
        }
        .prediction-panel {
          margin-top: 12px;
        }
        .model-bar {
          flex-direction: column;
          align-items: flex-start;
        }
        .model-tabs {
          justify-content: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <div class="card">
        <h1>Fake Review Detector</h1>
        <p class="subtitle">
          Paste a review, pick a model, and see if it looks
          <strong>real</strong> or <strong>fake</strong>.
        </p>

        <div class="layout">
          <div class="panel">
            <label for="reviewInput">Review text</label>
            <textarea
              id="reviewInput"
              placeholder="Paste or type the review you want to analyze..."
            ></textarea>

            <div class="controls-row">
              <div class="btn-group">
                <button id="analyzeButton" class="btn btn-primary">Analyze</button>
                <button id="clearButton" class="btn btn-secondary">Clear</button>
              </div>
              <div id="statusText" class="status">Ready.</div>
            </div>

            <div class="section-title">Recent analyses</div>
            <div id="historyList" class="history-list">
              <div class="history-empty">No analyses yet.</div>
            </div>
          </div>

          <div class="panel prediction-panel">
            <div class="prediction-header">Prediction</div>

            <div class="icon-wrapper neutral" id="iconWrapper">
              <svg
                id="humanIcon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12 2a4 4 0 1 1 0 8 4 4 0 0 1 0-8Zm-6.5 17.75C5.5 16.9 8.07 15 12 15s6.5 1.9 6.5 4.75V21a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1v-1.25Z"
                />
              </svg>

              <svg
                id="robotIcon"
                class="hidden"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
              >
                <path
                  d="M11 2a1 1 0 1 1 2 0v2h1a5 5 0 0 1 5 5v6a5 5 0 0 1-5 5H9a5 5 0 0 1-5-5V9a5 5 0 0 1 5-5h2V2Zm-3 8a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm8 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm-7.5 6h7a1 1 0 0 0 0-2h-7a1 1 0 0 0 0 2Z"
                />
              </svg>
            </div>

            <div class="tube-area">
              <div class="tube-label">Model confidence</div>
              <div class="tube">
                <div id="tubeFill" class="tube-fill"></div>
              </div>
            </div>

            <div class="prediction-text">
              <div id="predictionLabel" class="prediction-label">
                No result yet
              </div>
              <div id="confidenceText" class="prediction-confidence">–</div>
            </div>
          </div>
        </div>

        <div class="model-bar">
          <div class="model-label">Models</div>
          <div id="modelTabs" class="model-tabs">
            <button class="model-tab active" data-model="logreg_meta">
              LogReg + Meta
            </button>
            <button class="model-tab" data-model="ann">
              ANN (MLP)
            </button>
            <button class="model-tab" data-model="svm">
              Linear SVM
            </button>
            <button class="model-tab" data-model="logreg_basic">
              Plain Logistic Regression
            </button>
            <button class="model-tab" data-model="logreg_custom">
              Custom LogReg (Length-Weighted)
            </button>
            
          </div>
        </div>
      </div>
    </div>

    <script>
      var currentModel = "logreg_meta";

      var tabs = document.getElementById("modelTabs");
      var reviewInput = document.getElementById("reviewInput");
      var analyzeButton = document.getElementById("analyzeButton");
      var clearButton = document.getElementById("clearButton");
      var statusText = document.getElementById("statusText");
      var historyList = document.getElementById("historyList");

      var tubeFill = document.getElementById("tubeFill");
      var predictionLabel = document.getElementById("predictionLabel");
      var confidenceText = document.getElementById("confidenceText");
      var iconWrapper = document.getElementById("iconWrapper");
      var humanIcon = document.getElementById("humanIcon");
      var robotIcon = document.getElementById("robotIcon");

      tabs.addEventListener("click", function (event) {
        var target = event.target;
        if (!target.classList.contains("model-tab")) return;
        var model = target.getAttribute("data-model");
        if (!model) return;
        currentModel = model;
        setActiveTab(model);
      });

      function setActiveTab(model) {
        var buttons = tabs.querySelectorAll(".model-tab");
        for (var i = 0; i < buttons.length; i++) {
          var btn = buttons[i];
          if (btn.getAttribute("data-model") === model) {
            btn.classList.add("active");
          } else {
            btn.classList.remove("active");
          }
        }
      }

      // Buttons
      analyzeButton.addEventListener("click", function () {
        var text = reviewInput.value.trim();
        if (!text) {
          statusText.textContent = "Please enter a review first.";
          return;
        }
        runPrediction(text, currentModel);
      });

      clearButton.addEventListener("click", function () {
        reviewInput.value = "";
        resetResults();
        statusText.textContent = "Cleared. Ready.";
      });

      function resetResults() {
        tubeFill.style.height = "0%";
        predictionLabel.textContent = "No result yet";
        predictionLabel.className = "prediction-label";
        confidenceText.textContent = "–";
        iconWrapper.classList.add("neutral");
        humanIcon.classList.remove("hidden");
        robotIcon.classList.add("hidden");
      }

      function setPredictionDisplay(label, confidence) {
        var lower = String(label || "").toLowerCase();
        var isReal = lower === "real";
        var isFake = lower === "fake";

        if (isReal) {
          predictionLabel.textContent = "Human-written";
          predictionLabel.className = "prediction-label real";
        } else if (isFake) {
          predictionLabel.textContent = "AI-generated";
          predictionLabel.className = "prediction-label fake";
        } else {
          predictionLabel.textContent = label || "Unknown";
          predictionLabel.className = "prediction-label";
        }

        if (isReal) {
          iconWrapper.classList.remove("neutral");
          humanIcon.classList.remove("hidden");
          robotIcon.classList.add("hidden");
        } else if (isFake) {
          iconWrapper.classList.remove("neutral");
          humanIcon.classList.add("hidden");
          robotIcon.classList.remove("hidden");
        } else {
          iconWrapper.classList.add("neutral");
          humanIcon.classList.remove("hidden");
          robotIcon.classList.add("hidden");
        }

        if (confidence == null || isNaN(Number(confidence))) {
          confidenceText.textContent = "Confidence: N/A";
          tubeFill.style.height = "0%";
          return;
        }

        var p = Number(confidence);
        if (p < 0) p = 0;
        if (p > 1) p = 1;
        var percent = Math.round(p * 100);
        confidenceText.textContent = "Confidence: " + percent + "%";
        tubeFill.style.height = percent + "%";
      }

      function addToHistory(text, model, label, confidence) {
        var percent =
          confidence == null || isNaN(Number(confidence))
            ? "N/A"
            : Math.round(Number(confidence) * 100) + "%";

        var empty = historyList.querySelector(".history-empty");
        if (empty) {
          historyList.removeChild(empty);
        }

        var item = document.createElement("div");
        item.className = "history-item";

        var header = document.createElement("div");
        header.className = "history-header";

        var modelSpan = document.createElement("span");
        modelSpan.className = "history-model";
        modelSpan.textContent = model;

        var labelSpan = document.createElement("span");
        labelSpan.className = "history-label";
        labelSpan.textContent = label + " (" + percent + ")";

        var textDiv = document.createElement("div");
        textDiv.className = "history-text";
        textDiv.textContent = text;

        header.appendChild(modelSpan);
        header.appendChild(labelSpan);
        item.appendChild(header);
        item.appendChild(textDiv);

        historyList.prepend(item);
      }

      // ----- Backend stuff -----
      async function runPrediction(text, model) {
        statusText.textContent = "Running model '" + model + "'...";
        tubeFill.style.height = "0%";
        predictionLabel.textContent = "Predicting...";
        predictionLabel.className = "prediction-label";
        iconWrapper.classList.add("neutral");
        humanIcon.classList.remove("hidden");
        robotIcon.classList.add("hidden");
        confidenceText.textContent = "–";

        try {
          var response = await fetch("/api/predict", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: text, model: model }),
          });

          if (!response.ok) {
            statusText.textContent = "Server error " + response.status;
            return;
          }

          var data = await response.json();
          if (data.error) {
            statusText.textContent = "Error: " + data.error;
            return;
          }

          setPredictionDisplay(data.label, data.confidence);
          addToHistory(text, data.model, data.label, data.confidence);
          statusText.textContent = "Done.";
        } catch (err) {
          console.error(err);
          statusText.textContent = "Network or server error.";
        }
      }
      resetResults();
    </script>
  </body>
</html>
